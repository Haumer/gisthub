<div class="gist-card">
  <div class="gist-info">
    <% unless controller_is_users_show?(params) %>
      <div class="gist-hide">
        <%= link_to hide_gist_path(id: @gist.id) + "#gist#{@gist.id.to_s}", method: :post do %>
          <i class="fas <%= @gist.hide ? "fa-eye-slash" : "fa-eye" %>"></i>
        <% end %>
      </div>
      <div class="gist-star">
        <%= link_to star_gist_path(id: @gist.id) + "#gist#{@gist.id.to_s}", method: :post, remote: true do %>
          <i class="<%= @gist.star ? "fas" : "far" %> fa-star"></i>
        <% end %>
      </div>
    <% end %>
    <div class="language">
      <% @gist.languages_percent.each do |language, percent| %>
        <% if Language.find_by_name(language&.capitalize) %>
          <img class="language-icon" src="<%= Language.find_by_name(language.capitalize).img_url %>" alt="<%= language %>"> <%= percent.to_i %>%
        <% end %>
      <% end %>
    </div>
    <div class="files">
      <%= pluralize(@gist.gist_files.count, "File") %>:
      <% @gist.gist_files.first(3).each do |file| %>
        <%= link_to file, data: { turbolinks: false } do %>
          <%= file.filename %>
        <% end %>
      <% end %>
      <% if @gist.gist_files.count > 3 %>
        ...
      <% end %>
    </div>
    <div class="comments">
      <%= link_to @gist_url, target: "_blank" do %>
        <%= @gist.comments %> <i class="far fa-comment"></i>
      <% end %>
    </div>
    <button type="button" class="gist-options" data-toggle="modal" data-target="#Gist<%=  @gist.id%>">
      <i class="fas fa-cog"></i>
    </button>
  </div>
  <div class="date">
    Created: <%= DateTime.strptime(@gist.date).strftime("%e %b %Y %H:%M:%S%p")
 %>
  </div>
</div>

<div class="modal fade" id="Gist<%= @gist.id%>" tabindex="-1" role="dialog" aria-labelledby="Gist<%= @gist.id%>" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Options</h5>
        <div class="edit-gist">
                <%= link_to @edit_url, target: "_blank" do %>
                  <i class="far fa-edit"></i>
                <% end %>
              </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="gist-options-modal">
          <% unless controller_is_users_show?(params) %>
            <% if permitted? %>
              <% @gist.labels.each do |label| %>
                <%= label.name %>
              <% end %>
              <div class="add-label">
                <%= render "gist_labels/form", gist_label: GistLabel.new, gist: @gist, class: "hidden" %>
              </div>
              <div class="add-group">
                <%= render "group_gists/form", user: @user, gist: @gist %>
              </div>
            <% end %>
          <% end %>
          <div class="group-slugs">
            <% @gist.groups.each do |group|%>
              <%= link_to group, data: { turbolinks: false } do %>
                <div class="group-slug" style="border-bottom: 3px solid <%= group.color %>">
                  <%= group.slug %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
